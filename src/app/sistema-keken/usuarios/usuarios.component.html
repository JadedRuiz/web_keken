<div class="container-fluid" style="padding-top: 120px;">
    <div class="row">
        <div class="col-12 table-responsive">
            <div class="table-wrapper">
                <div class="table-title px-1 py-1">
                    <div class="row">
                        <div class="col-sm-6">
                            <h2>USUARIOS</h2>
                        </div>
                        <div class="col-sm-6 text-right">
                            <a class="btn btn-success" (click)="nuevoUsuario()"><i class="fas fa-plus-circle"></i>&nbsp;Nuevo usuario</a>
                        </div>
                    </div>
                </div>
                <table class="table table-striped table-hover mt-1">
                    <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>Usuario</th>
                            <th>Empresa</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody *ngIf="usuarios.length > 0; else pintaVacio">
                        <tr *ngFor="let usuario_row of usuarios">
                          <td colspan="1">{{usuario_row.nombre}}</td>
                          <td colspan="1">{{usuario_row.usuario}}</td>
                          <td colspan="1">{{usuario_row.razon_social}}</td>
                          <td colspan="1">
                            <button class="btn btn-yellow btn-sm text-white" (click)="editar(usuario_row.id_usuario)"><i class="fas fa-eye"></i></button>
                          </td>
                        </tr>	
                    </tbody>
                    <ng-template #pintaVacio>
                        <tbody>
                            <tr>
                                <td colspan="4" class="text-center">No existen usuarios</td>
                            </tr>
                        </tbody>
                    </ng-template>
                </table>
                <div class="col-12 text-right">
                    <nav *ngIf="mostrar_pagination" aria-label="Page navigation example">
                        <div class="hint-text">Mostrando <b>5</b> de <b>25</b> usuarios</div>
                        <ul class="pagination">
                          <li class="page-item" *ngIf="previous">
                            <a class="page-link" href="#" aria-label="Previous">
                              <span aria-hidden="true">&laquo;</span>
                              <span class="sr-only">Previous</span>
                            </a>
                          </li>
                          <li *ngFor="let pagina of paginas" class="page-item {{pagina.active}}" (click)="irPagina(pagina.valor_pagina)"><a class="page-link" style="cursor: pointer;">{{pagina.numero}}</a></li>
                          <li class="page-item" *ngIf="next">
                            <a class="page-link" href="#" aria-label="Next">
                              <span aria-hidden="true">&raquo;</span>
                              <span class="sr-only">Next</span>
                            </a>
                          </li>
                        </ul>
                      </nav>
                </div>
            </div>
        </div>
    </div>
</div>
<ng-template #content let-modal>
  <div class="modal-header">
    <h3 class="modal-title" *ngIf="tipo_modal == 1">NUEVO USAURIO</h3>
    <h3 class="modal-title" *ngIf="tipo_modal == 2">VISUALIZAR USUARIO</h3>
  </div>
  <div class="modal-body" style="height: 400px;">
    <div class="container">
        <div class="row">
            <div class="col-sm-12 col-md-12">
                <div style="width: 200px; height: 200px;position: relative;margin: auto;">
                  <img  class="rounded-circle" [src]="url_foto" style="width: 100%;height: 100%;">
                  <div ngbDropdown class="d-inline-block float-right" style="position: absolute;bottom: 0px;cursor: pointer;right: 0px;" placement="bottom-right">
                      <div class="rounded-circle {{color}}" style="height: 40px; width: 40px; display: flex; justify-content: center; align-items: center;" title="Subir foto" (mouseover)="changeStyle($event)" (mouseout)="changeStyle($event)" ngbDropdownToggle><i class="fas fa-camera text-white" ></i></div>
                      <div ngbDropdownMenu aria-labelledby="dropdownBasic1">
                        <button ngbDropdownItem>
                          <p class="py-0 px-0 my-0 mx-0" (click)="subirImagen()"><i class="fas fa-file-upload"></i> &nbsp; Subir fotografía</p>
                          <input type="file" style="display: none;" id="foto_user" (change)="cambiarImagen($event)">
                        </button>
                        <button ngbDropdownItem>
                          <p class="py-0 px-0 my-0 mx-0" (click)="tomarFoto()"><i class="fas fa-camera-retro"></i> &nbsp; Tomar fotografía</p>
                        </button>
                      </div>
                  </div>
                </div>
            </div>
            <div class="col-sm-12 col-md-12">
                <div class="row">
                    <div *ngIf="id_perfil == 1" class="col-sm-12">
                      <mat-form-field class="w-100">
                          <mat-label>Nombre</mat-label>
                          <input matInput [(ngModel)]="usuario.nombre" style="text-transform: uppercase;">
                      </mat-form-field>
                    </div>
                    <div *ngIf="id_perfil == 1" class="col-sm-12">
                      <mat-form-field class="w-100">
                          <mat-label>Empresa</mat-label>
                          <mat-select [(ngModel)]="usuario.id_empresa">
                            <mat-option *ngFor="let empresa of empresas" value="{{empresa.id_empresa}}">{{empresa.razon_social}}</mat-option>
                          </mat-select>
                      </mat-form-field>
                      </div>
                    <div *ngIf="id_perfil != 1" class="col-sm-12">
                      <mat-form-field class="w-100">
                          <mat-label>Nombre</mat-label>
                          <input matInput [(ngModel)]="usuario.nombre" style="text-transform: uppercase;">
                      </mat-form-field>
                    </div>
                    <div class="col-sm-12 col-md-6">
                      <mat-form-field appearance="legacy" class="w-100">
                          <mat-label>Usuario</mat-label>
                          <input matInput [(ngModel)]="usuario.usuario">
                          <mat-icon matSuffix><i class="fas fa-user"></i></mat-icon>
                        </mat-form-field>
                    </div>
                    <div class="col-sm-12 col-md-6">
                      <mat-form-field appearance="legacy" class="w-100">
                          <mat-label>Contraseña</mat-label>
                          <input matInput type="password" [(ngModel)]="usuario.password">
                          <mat-icon matSuffix><i class="fas fa-lock"></i></mat-icon>
                        </mat-form-field>
                    </div>
                </div>
            </div>
        </div>
        <div class="row mt-3">
            <div class="col-sm-12 col-md-6">
              <mat-form-field class="w-100">
                <mat-label>Selecciona el perfil</mat-label>
                <mat-select [(ngModel)]="usuario.id_perfil" (selectionChange)="mostrarOpciones()">
                  <mat-option *ngFor="let perfil of perfiles" [value]="perfil.id_perfil">
                    {{perfil.perfil}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <div class="col-sm-12 col-md-6">
              <mat-form-field class="w-100">
                <mat-label>{{opcion.nombre}}</mat-label>
                <mat-select  [disabled]="opcion.band" [(ngModel)]="usuario.id_opcion">
                  <mat-option *ngFor="let opcion_sl of opcion.valores" [value]="opcion_sl.id">
                    {{opcion_sl.nombre}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
        </div>
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-warning" (click)="modal.close()"><i class="fas fa-window-close"></i> &nbsp; Cerrar</button>
    <button type="button" *ngIf="tipo_modal == 1" class="btn btn-info" (click)="guardarUsuario()"><i class="fas fa-save"></i> &nbsp; Guardar</button>
    <button type="button" *ngIf="tipo_modal == 2" class="btn btn-info"><i class="fas fa-save"></i> &nbsp; Guardar</button>
  </div>
</ng-template>
<ng-template #modal_camera let-camera>
  <div class="modal-header">
      <h2 class="modal-title" id="tituloModal">Tomar fotografia</h2>
  </div>
  <div class="modal-body">
      <div class="container">
          <div class="row">
              <div *ngIf="isCameraExist; else noCameraExist" class="col-12">
                  <div class="border border-success rounded text-center" style="width: 100%;height: 265px;">
                      <webcam [height]="450" [width]="350" [trigger]="triggerObservable" (imageCapture)="handleImage($event)"
                      *ngIf="showWebcam" [switchCamera]="nextWebcamObservable"></webcam>
                  </div>
              
                  <div *ngIf="errors.length > 0">
                      <h4>Error Messages:</h4>
                      <ul *ngFor="let error of errors">
                          <li>{{ error | json }}</li>
                      </ul>
                  </div>
              </div>
              
              <ng-template #noCameraExist>
                  <div class="border border-danger rounded text-center" style="display: flex;justify-content: center;align-items: center;width: 450px;height: 350px;">
                      Este dispositivo no cuenta con una camara disponible
                  </div>
              </ng-template>
          </div>
      </div>
  </div>
  <div class="modal-footer">
      <button type="button" class="btn btn-warning" (click)="camera.close()">Cerrar</button>
      <button *ngIf="isCameraExist" type="button" class="btn btn-success" (click)="takeSnapshot()">Tomar foto</button>
  </div>
</ng-template>